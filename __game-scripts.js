var Follow=pc.createScript("follow");Follow.attributes.add("target",{type:"entity",title:"Target",description:"The Entity to follow"}),Follow.attributes.add("distance",{type:"number",default:4,title:"Distance",description:"How far from the Entity should the follower be"}),Follow.prototype.initialize=function(){this.vec=new pc.Vec3,this.cameraAngle=5,this.accelerate=!1,this.accelerateB=!1,this.right=!1,this.left=!1,this.defaultDistance=this.distance,this.zoomOutTicks=0,this.simpleControl=!1,this.app.on("turnLeft",this.onLeftEvent,this),this.app.on("turnRight",this.onRightEvent,this),this.force=new pc.Vec3,this.app.on("mdown",this.onDown,this),this.app.on("mup",this.onUp,this),this.app.on("mbdown",this.onBDown,this),this.app.on("mbup",this.onBUp,this),this.app.on("ldown",this.onLDown,this),this.app.on("lup",this.onLUp,this),this.app.on("rdown",this.onRDown,this),this.app.on("rup",this.onRUp,this),this.app.on("simpleControl",this.onControlChange,this)},Follow.prototype.update=function(t){if(this.target){for(this.distance=this.defaultDistance,this.calculateDistance();this.checkObstackle();){let t=this.distance-.2;if(t<.005){t=.005,this.distance=t,this.calculateDistance();break}this.distance=t,this.calculateDistance()}this.left&&(this.cameraAngle+=.02),this.right&&(this.cameraAngle-=.02),this.accelerate&&this.calculateAccelaration(-.1),this.accelerateB&&this.calculateAccelaration(.1),(this.app.keyboard.isPressed(pc.KEY_LEFT)||this.app.keyboard.isPressed(pc.KEY_A))&&(this.cameraAngle+=.02),(this.app.keyboard.isPressed(pc.KEY_RIGHT)||this.app.keyboard.isPressed(pc.KEY_D))&&(this.cameraAngle-=.02),(this.app.keyboard.isPressed(pc.KEY_UP)||this.app.keyboard.isPressed(pc.KEY_W))&&this.calculateAccelaration(-.1),(this.app.keyboard.isPressed(pc.KEY_DOWN)||this.app.keyboard.isPressed(pc.KEY_S))&&this.calculateAccelaration(.1)}},Follow.prototype.calculateAccelaration=function(t){if(1==this.simpleControl&&t>0){var i=this.target.rigidbody.linearVelocity;i.z>0?(this.force.z=i.z-t,this.force.z<0&&(this.force.z=0)):(this.force.z=i.z+t,this.force.z>0&&(this.force.z=0)),i.x>0?(this.force.x=i.x-t,this.force.x<0&&(this.force.x=0)):(this.force.x=i.x+t,this.force.x>0&&(this.force.x=0)),this.force.y=i.y,this.target.rigidbody.linearVelocity=this.force}else this.force.z=Math.cos(this.cameraAngle)*t,this.force.x=Math.sin(this.cameraAngle)*t,this.target.rigidbody.applyImpulse(this.force)},Follow.prototype.calculateDistance=function(){var t=this.target.getPosition();t.x+=Math.sin(this.cameraAngle)*this.distance,t.y+=.5*this.distance,t.z+=Math.cos(this.cameraAngle)*this.distance,this.vec.lerp(this.vec,t,.1),this.entity.setPosition(this.vec),this.entity.lookAt(this.target.getPosition())},Follow.prototype.onControlChange=function(t){console.log("simpleControl=",t),this.simpleControl=t},Follow.prototype.onDown=function(){this.accelerate=!0},Follow.prototype.onUp=function(){this.accelerate=!1},Follow.prototype.onBDown=function(){this.accelerateB=!0},Follow.prototype.onBUp=function(){this.accelerateB=!1},Follow.prototype.onLDown=function(){this.left=!0},Follow.prototype.onLUp=function(){this.left=!1},Follow.prototype.onRDown=function(){this.right=!0},Follow.prototype.onRUp=function(){this.right=!1},Follow.prototype.checkObstackle=function(){const t=this.app.systems.rigidbody.raycastFirst(this.entity.getPosition(),this.target.getPosition());return!(!t||"Ball"==t.entity.name)};var Movement=pc.createScript("movement");Movement.attributes.add("speed",{type:"number",default:.1,min:0,max:.5,precision:2,description:"Controls the movement speed"}),Movement.prototype.initialize=function(){this.force=new pc.Vec3,this.app.on("changePosition",this.onChangePositionEvent,this),this.app.on("turnLeft",this.onLeftEvent,this),this.app.on("turnRight",this.onRightEvent,this)},Movement.prototype.update=function(e){var t=0,i=0;if(this.app.keyboard.isPressed(pc.KEY_LEFT)&&(t=-this.speed),this.app.keyboard.isPressed(pc.KEY_RIGHT)&&(t+=this.speed),this.app.keyboard.isPressed(pc.KEY_UP)&&(i=-this.speed),this.app.keyboard.isPressed(pc.KEY_DOWN)&&(i+=this.speed),this.force.x=t,this.force.z=i,this.force.length()){var s=Math.cos(.25*-Math.PI),o=Math.sin(.25*-Math.PI);this.force.set(this.force.x*s-this.force.z*o,0,this.force.z*s+this.force.x*o),this.force.length(),this.speed}},Movement.prototype.onChangePositionEvent=function(e,t,i){var s=-this.speed;if(this.force.z=s,this.force.length()){var o=Math.cos(.25*-Math.PI),h=Math.sin(.25*-Math.PI);this.force.set(this.force.x*o-this.force.z*h,0,this.force.z*o+this.force.x*h),this.force.length()>this.speed&&this.force.normalize().scale(this.speed)}this.entity.rigidbody.applyImpulse(this.force)},Movement.prototype.onLeftEvent=function(){this.cameraAngle+=3},Movement.prototype.onRightEvent=function(){this.cameraAngle-=3};var Teleportable=pc.createScript("teleportable");Teleportable.prototype.initialize=function(){this.lastTeleportFrom=null,this.lastTeleportTo=null,this.lastTeleport=Date.now(),this.startPosition=this.entity.getPosition().clone(),this.app.on("reset",this.onReset,this)},Teleportable.prototype.update=function(t){this.entity.getPosition().y<-3&&this.teleport(this.lastTeleportFrom,this.lastTeleportTo)},Teleportable.prototype.onReset=function(){this.resetPosition(this.startPosition)},Teleportable.prototype.teleport=function(t,e){var o;t&&Date.now()-this.lastTeleport<500||(this.lastTeleport=Date.now(),this.lastTeleportFrom=t,this.lastTeleportTo=e,e?(o=e.getPosition()).y+=.5:o=this.startPosition,this.resetPosition(o))},Teleportable.prototype.resetPosition=function(t){this.entity.rigidbody.teleport(t),this.entity.rigidbody.linearVelocity=pc.Vec3.ZERO,this.entity.rigidbody.angularVelocity=pc.Vec3.ZERO};var Teleport=pc.createScript("teleport");Teleport.attributes.add("target",{type:"entity",title:"Target Entity",description:"The target entity where we are going to teleport"}),Teleport.prototype.initialize=function(){this.target&&this.entity.collision.on("triggerenter",this.onTriggerEnter,this)},Teleport.prototype.onTriggerEnter=function(t){t.script.teleportable&&t.script.teleportable.teleport(this.entity,this.target)};var TouchHandle=pc.createScript("touchHandle");TouchHandle.prototype.update=function(t){},TouchHandle.attributes.add("redMaterial",{type:"asset",assetType:"material",title:"Red Material"}),TouchHandle.attributes.add("greenMaterial",{type:"asset",assetType:"material",title:"Green Material"}),TouchHandle.prototype.initialize=function(){this.pos=new pc.Vec3,this.cameraEntity=this.app.root.findByName("Camera");var t=this.app.touch;t&&(t.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),t.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),t.on(pc.EVENT_TOUCHEND,this.onTouchEnd,this),t.on(pc.EVENT_TOUCHCANCEL,this.onTouchCancel,this)),this.on("destroy",(function(){t.off(pc.EVENT_TOUCHSTART,this.onTouchStart,this),t.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),t.off(pc.EVENT_TOUCHEND,this.onTouchEnd,this),t.off(pc.EVENT_TOUCHCANCEL,this.onTouchCancel,this)}),this)},TouchHandle.prototype.updateFromScreen=function(t){this.cameraEntity.camera.screenToWorld(t.x,t.y,25,this.pos),this.entity.setPosition(this.pos)},TouchHandle.prototype.changeMaterial=function(t){for(var e=this.entity.findComponents("render"),o=0;o<e.length;++o)for(var n=e[o].meshInstances,a=0;a<n.length;a++)n[a].material=t.resource},TouchHandle.prototype.onTouchStart=function(t){1===t.touches.length&&this.updateFromScreen(t.touches[0]),t.event.preventDefault()},TouchHandle.prototype.onTouchMove=function(t){this.updateFromScreen(t.touches[0]),t.event.preventDefault()},TouchHandle.prototype.onTouchEnd=function(t){t.touches.length,t.event.preventDefault()},TouchHandle.prototype.onTouchCancel=function(t){t.touches.length,t.event.preventDefault()};var Forward=pc.createScript("forward");Forward.prototype.initialize=function(){};var BackClick=pc.createScript("backClick");BackClick.prototype.initialize=function(){var t=this;this.entity.button.on("pressedstart",(function(i){t.app.fire("mbdown")}),this),this.entity.button.on("pressedend",(function(i){t.app.fire("mbup")}),this)},BackClick.prototype.update=function(t){};var Left=pc.createScript("left");Left.prototype.initialize=function(){var t=this;this.entity.button.on("pressedstart",(function(e){t.app.fire("ldown")}),this),this.entity.button.on("pressedend",(function(e){t.app.fire("lup")}),this)},Left.prototype.update=function(t){};var Right=pc.createScript("right");Right.prototype.initialize=function(){var t=this;this.entity.button.on("pressedstart",(function(i){t.app.fire("rdown")}),this),this.entity.button.on("pressedend",(function(i){t.app.fire("rup")}),this)},Right.prototype.update=function(t){};var Click=pc.createScript("click");Click.prototype.initialize=function(){var t=this;this.entity.button.on("pressedstart",(function(i){t.app.fire("mdown")}),this),this.entity.button.on("pressedend",(function(i){t.app.fire("mup")}),this)},Click.prototype.update=function(t){};var TriggerUp=pc.createScript("triggerUp");TriggerUp.prototype.initialize=function(){this.entity.collision.on("collisionstart",this.onCollisionStart,this),this.entity.collision.on("collisionend",this.onCollisionEnd,this),this.activated=!1;var t=this.entity.getPosition();this.lowerPos=t.y,this.upperPos=this.lowerPos+3,this.cooldownCount=0},TriggerUp.prototype.update=function(t){var i=this.entity.getPosition();1==this.activated&&i.y<=this.upperPos&&this.entity.translate(0,.003,0),this.cooldownCount>0&&(this.cooldownCount--,0==this.cooldownCount&&(this.activated=!1)),0==this.activated&&(i.y>=this.lowerPos?this.entity.translate(0,-.03,0):this.cooldownCount=0)},TriggerUp.prototype.onCollisionStart=function(t){"Ball"==t.other.name&&(this.activated=!0)},TriggerUp.prototype.onCollisionEnd=function(t){this.cooldownCount=1e3};var Collect=pc.createScript("collect");Collect.prototype.initialize=function(){this.entity.collision.on("triggerenter",this.onTriggerEnter,this)},Collect.prototype.update=function(t){},Collect.prototype.onTriggerEnter=function(t){"Ball"==t.name&&(this.app.fire("coin"),this.entity.parent.enabled=!1)};var Rotate=pc.createScript("rotate");Rotate.prototype.initialize=function(){let t=90*Math.random();console.log("ANGLE: ",t),this.entity.rotate(0,t,0)},Rotate.prototype.update=function(t){this.entity.rotate(4,2,0)};var CoinCollect=pc.createScript("coinCollect");CoinCollect.prototype.initialize=function(){this.app.on("coin",this.onCollect,this),this.app.on("finishOn",this.onFinishOn,this),this.app.on("finishOff",this.onFinishOff,this),this.app.on("reset",this.onReset,this),this.app.on("simpleControl",this.onControlChange,this),this.points=0,this.hardMode=!0,this.submittedPoints=0,this.pointsToSubmit=0,this.submitEn=this.entity.parent.findByName("SubmitEn"),this.submitEn.button.on("click",(function(t){window.open("https://t.me/ThreeDBallNews","_blank")}),this),this.submitUa=this.entity.parent.findByName("SubmitUa"),this.submitUa.button.on("click",(function(t){window.open("https://t.me/threedballnewsua","_blank")}),this),this.submitRu=this.entity.parent.findByName("SubmitRu"),this.submitRu.button.on("click",(function(t){window.open("https://t.me/threedballnewsru","_blank")}),this)},CoinCollect.prototype.onReset=function(){this.points=0,this.entity.element.text=" "},CoinCollect.prototype.onSubmit=function(t){var i=new URL(location.href),n=i.searchParams.get("debug");if(null==n||0==n){var o=new XMLHttpRequest,e=i.searchParams.get("pt");e>0?o.open("GET","https://threedballbot.herokuapp.com:"+e+"/submit/"+t+location.search,!0):o.open("GET","https://threedballbot.herokuapp.com:/submit/"+t+location.search,!0),o.onreadystatechange=function(){if(o.readyState===XMLHttpRequest.DONE){var t=xhr.status;0===t||t>=200&&t<400?(console.log(xhr.responseText),this.submittedPoints=this.pointsToSubmit):console.log("status",t," state:",o.readyState)}},o.send()}else this.pointsToSubmit=9999,console.log("debug - no score send")},CoinCollect.prototype.onControlChange=function(t){this.hardMode=!t},CoinCollect.prototype.update=function(t){},CoinCollect.prototype.onCollect=function(){var t=3;this.hardMode||(t=2),this.points=this.points+t,this.entity.element.text="score: "+this.points,this.points>this.pointsToSubmit&&(this.pointsToSubmit=this.points,this.onSubmit(this.points))},CoinCollect.prototype.onFinishOn=function(){this.submitEn.enabled=!0,this.submitRu.enabled=!0,this.submitUa.enabled=!0},CoinCollect.prototype.onFinishOff=function(){this.submitEn.enabled=!1,this.submitRu.enabled=!1,this.submitUa.enabled=!1};var SceneHandler=pc.createScript("sceneHandler");SceneHandler.prototype.initialize=function(){var e=this.app.assets.get(66571358);this.app.assets.load(e);var n=document.createElement("style");n.innerHTML=e.resource||"",document.head.appendChild(n),e.on("load",(function(){n.innerHTML=e.resource||"",console.log(e.resource||"")}))},SceneHandler.prototype.update=function(e){};var PlayerName=pc.createScript("playerName");PlayerName.prototype.initialize=function(){var t=new URL(location.href);t.searchParams.get("id"),t.searchParams.get("pt");this.version="v1.0.14",this.entity.element.text=this.version+" H",this.app.on("submitScr",this.onSubmit,this),this.app.on("simpleControl",this.onControlChange,this),this.entity.element.on("click",this.onClick,this)},PlayerName.prototype.update=function(t){},PlayerName.prototype.onControlChange=function(t){this.entity.element.text=t?this.version+" S":this.version+" H"},PlayerName.prototype.onClick=function(t){console.log("click on playersName"),this.app.fire("showMenu"),this.app.fire("hideUI")},PlayerName.prototype.onSubmit=function(t){console.log("onSubmit, points: ",t);var e=new XMLHttpRequest;e.open("GET","submit/"+t+location.search,!0),e.onreadystatechange=function(){if(e.readyState===XMLHttpRequest.DONE){var t=xhr.status;0===t||t>=200&&t<400?console.log(xhr.responseText):console.log("status",t," state:",e.readyState)}},e.send()};var Finish=pc.createScript("finish");Finish.prototype.initialize=function(){this.entity.collision.on("triggerenter",this.onTriggerEnter,this),this.entity.collision.on("triggerleave",this.onTriggerLeave,this)},Finish.prototype.update=function(i){},Finish.prototype.onTriggerLeave=function(i){"Ball"==i.name&&this.app.fire("finishOff")},Finish.prototype.onTriggerEnter=function(i){"Ball"==i.name&&this.app.fire("finishOn")};var SpawnCoins=pc.createScript("spawnCoins");SpawnCoins.prototype.initialize=function(){this.app.on("reset",this.onReset,this)},SpawnCoins.prototype.update=function(n){},SpawnCoins.prototype.onReset=function(){this.entity.children.forEach((n=>n.enabled=!0))};var ChangeControl=pc.createScript("changeControl");ChangeControl.prototype.initialize=function(){this.usingHard=!0,this.selectedHard=!0,this.app.on("reset",this.onReset,this),this.app.on("hideMenu",this.onHide,this),this.app.on("showMenu",this.onShow,this),this.entity.button.on("pressedend",(function(t){this.selectedHard=!this.selectedHard,this.showSelectedControls()}),this)},ChangeControl.prototype.onHide=function(){0==this.usingHard&&(this.usingHard=this.selectedHard,this.app.fire("simpleControl",!this.usingHard))},ChangeControl.prototype.onShow=function(){this.showSelectedControls()},ChangeControl.prototype.onReset=function(){this.usingHard=this.selectedHard,this.app.fire("simpleControl",!this.usingHard)},ChangeControl.prototype.showSelectedControls=function(){this.selectedHard?this.entity.element.text="Hard controls":this.entity.element.text="Simple contols",0==this.selectedHard&&1==this.usingHard&&(this.entity.element.text="Simple controls (reset required)")},ChangeControl.prototype.update=function(t){};var HideMenu=pc.createScript("hideMenu");HideMenu.prototype.initialize=function(){this.entity.button.on("pressedend",(function(e){this.app.fire("hideMenu")}),this)},HideMenu.prototype.update=function(e){};var Reset=pc.createScript("reset");Reset.prototype.initialize=function(){this.entity.button.on("pressedend",(function(e){this.app.fire("hideMenu"),this.app.fire("reset")}),this)},Reset.prototype.update=function(e){};var Menu=pc.createScript("menu");Menu.prototype.initialize=function(){this.app.on("hideMenu",this.onHide,this),this.app.on("showMenu",this.onShow,this),this.menu=this.entity.findByName("Menu"),this.ui=this.entity.findByName("UI")},Menu.prototype.onHide=function(e){this.menu.enabled=!1,this.ui.enabled=!0},Menu.prototype.onShow=function(e){this.ui.enabled=!1,this.menu.enabled=!0},Menu.prototype.update=function(e){};